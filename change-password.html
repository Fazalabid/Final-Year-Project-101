<!-- change-password.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Change Password</title>
    <link
      rel="stylesheet"
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h2>Change Password</h2>
      <form id="changePasswordForm">
        <div class="mb-3">
          <label>Current Password</label>
          <input
            type="password"
            class="form-control"
            id="passwordCurrent"
            required
          />
        </div>
        <div class="mb-3">
          <label>New Password</label>
          <input type="password" class="form-control" id="password" required />
        </div>
        <div class="mb-3">
          <label>Confirm New Password</label>
          <input
            type="password"
            class="form-control"
            id="passwordConfirm"
            required
          />
        </div>
        <button type="submit" class="btn btn-warning">Update Password</button>
        <a href="index.html" class="btn btn-secondary ms-2">Cancel</a>
      </form>
    </div>

    <script>
      const token = localStorage.getItem("token");
      const userId = JSON.parse(atob(token.split(".")[1])).id;

      document
        .getElementById("changePasswordForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const passwordCurrent =
            document.getElementById("passwordCurrent").value;
          const password = document.getElementById("password").value;
          const passwordConfirm =
            document.getElementById("passwordConfirm").value;

          if (password !== passwordConfirm) {
            return alert("❗ New passwords do not match");
          }

          const res = await fetch(
            `http://localhost:5000/api/auth/updateMyPassword`,
            {
              method: "PATCH",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({
                passwordCurrent,
                password,
                passwordConfirm: passwordConfirm,
              }),
            }
          );

          const data = await res.json();
          if (!res.ok)
            return alert(data.message || "Failed to change password");
          alert("✅ Password updated successfully");
          window.location.href = "index.html";
        });
    </script>
  </body>
</html>
